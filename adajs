private setupCustomDropdown(): void {
  const toggleSelector = `.${this.calculatorID}-custom-dropdown-toggle`;
  const dropdownSelector = `.${this.calculatorID}-custom-dropdown-list`;
  const optionSelector = `.${this.calculatorID}-custom-dropdown-list-option`;

  const toggle = document.querySelector<HTMLElement>(toggleSelector);
  const dropdown = document.querySelector<HTMLElement>(dropdownSelector);

  if (!toggle || !dropdown) return;

  const wrapper = toggle.closest<HTMLElement>(`.${this.calculatorID}-custom-dropdown-wrapper`);
  const options = Array.from(dropdown.querySelectorAll<HTMLElement>(optionSelector));

  if (!wrapper) return;

  // Set ARIA attributes
  wrapper.setAttribute("role", "combobox");
  wrapper.setAttribute("aria-haspopup", "listbox");
  wrapper.setAttribute("aria-expanded", "false");
  wrapper.setAttribute("aria-controls", `${this.calculatorID}-dropdown-list`);
  wrapper.setAttribute("tabindex", "0");

  dropdown.setAttribute("role", "listbox");
  dropdown.setAttribute("id", `${this.calculatorID}-dropdown-list`);
  dropdown.hidden = true;

  options.forEach((option) => {
    option.setAttribute("role", "option");
    option.setAttribute("tabindex", "-1");
  });

  const toggleDropdown = (open: boolean): void => {
    wrapper.setAttribute("aria-expanded", String(open));
    dropdown.hidden = !open;

    toggle.classList.toggle("hx-icon-interactive-caret-up", open);
    toggle.classList.toggle("hx-icon-interactive-caret-down", !open);

    if (open) {
      const selected = options.find((opt) =>
        opt.classList.contains("uc-icon-action-checkmark")
      );
      (selected ?? options[0]).focus();
    }
  };

  // Handle option click
  options.forEach((option) => {
    option.addEventListener("click", () => {
      const span = option.querySelector<HTMLElement>(
        `.${this.calculatorID}-custom-dropdown-tier`
      );
      const tierName = span?.textContent?.trim() || "";

      options.forEach((opt) => opt.classList.remove("uc-icon-action-checkmark"));
      option.classList.add("uc-icon-action-checkmark");

      toggle.textContent = tierName;
      toggle.focus();
      toggleDropdown(false);

      this.removeRedbox(tierName.toLowerCase());
      this.redBox();
    });

    // Keyboard navigation on options
    option.addEventListener("keydown", (event: KeyboardEvent) => {
      const index = options.indexOf(option);
      if (event.key === "ArrowDown") {
        event.preventDefault();
        const next = options[(index + 1) % options.length];
        next?.focus();
      } else if (event.key === "ArrowUp") {
        event.preventDefault();
        const prev = options[(index - 1 + options.length) % options.length];
        prev?.focus();
      } else if (event.key === "Enter" || event.key === " ") {
        event.preventDefault();
        option.click();
      } else if (event.key === "Escape") {
        event.preventDefault();
        toggleDropdown(false);
        wrapper.focus();
      }
    });
  });

  // Toggle dropdown on toggle click
  toggle.addEventListener("click", (event: MouseEvent) => {
    event.stopPropagation();
    const isOpen = wrapper.getAttribute("aria-expanded") === "true";
    toggleDropdown(!isOpen);
  });

  // Toggle dropdown on keypress on wrapper
  wrapper.addEventListener("keydown", (event: KeyboardEvent) => {
    const isOpen = wrapper.getAttribute("aria-expanded") === "true";

    switch (event.key) {
      case "Enter":
      case " ":
        event.preventDefault();
        toggleDropdown(!isOpen);
        break;
      case "ArrowDown":
        event.preventDefault();
        toggleDropdown(true);
        options[0]?.focus();
        break;
      case "Escape":
        event.preventDefault();
        toggleDropdown(false);
        break;
    }
  });

  // Close dropdown when clicking outside
  document.addEventListener("click", (event: MouseEvent) => {
    if (!wrapper.contains(event.target as Node)) {
      toggleDropdown(false);
    }
  });

  // Mark selected tier on load
  const selectedText = toggle.textContent?.trim().toLowerCase();
  options.forEach((option) => {
    const span = option.querySelector<HTMLElement>(
      `.${this.calculatorID}-custom-dropdown-tier`
    );
    const text = span?.textContent?.trim().toLowerCase();
    if (text === selectedText) {
      option.classList.add("uc-icon-action-checkmark");
    } else {
      option.classList.remove("uc-icon-action-checkmark");
    }
  });
}
